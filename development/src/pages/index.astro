---
import Layout from "@/layouts/Layout.astro";
import { PortfolioApp } from "@/components/PortfolioApp";
import { getCollection } from "astro:content";
import { renderMarkdown } from "@/lib/markdown";

// Fetch sections from content collection
const allSections = await getCollection("sections", ({ data }) => {
    // In production, only show published sections. In dev, show all.
    return import.meta.env.PROD ? data.published : true;
});

// Sort sections by order
const sortedSections = allSections.sort((a, b) => a.data.order - b.data.order);

// Process sections for the app
const sections = sortedSections.map((section) => ({
    id: section.slug,
    title: section.data.title,
    description: section.data.description,
    html: renderMarkdown(section.body),
}));
---

<Layout>
    <PortfolioApp client:load sections={sections} />
</Layout>
